<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <!--Styles for CSS -->
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    header {
      background-color: black;
      color: white;
      height: 50px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .input {
      display: block;
      margin-bottom: 5px;
      width: 200px;
    }

    main {
      padding: 10px;
    }

    button {
      border: 1px solid black;
      background-color: white;
      padding: 5px 10px;
      margin-top: 5px;
    }

    form {
      max-width: 230px;
      margin: auto;
      border: 1px solid black;
      padding: 20px;
      margin-bottom: 30px;
    }
  </style>

  <body>
    <header>
      <p>Euclid API test</p>
    </header>
    <main>
      <form>
        <input
          class="input"
          label="book"
          type="text"
          name="book"
          placeholder="Search for a book"
        />
        <input
          class="input"
          label="prop"
          type="text"
          name="prop"
          placeholder="Search for a proposition"
        />
        <button type="submit">Submit</button>
      </form>
      <div></div>
    </main>

    <script>
      const btn = document.querySelector('button[type="submit"]');
      //render html from data
      function renderHTML(data) {
        const firstSentenceLength = data.text.split(".")[0].length + 1;

        return `
          <div style="max-width: 500px; margin: auto">
            <h1 style="margin: 10px">Book: ${data.book}</h1>
            <h1 style="margin: 10px">Proposition: ${data.proposition}</h1>
            <p style="margin: 10px">TEXT: ${data.text.substring(
              firstSentenceLength
            )}</p>
            <p style="margin: 10px">PROPOSITIONS USED: ${data.propsCited.join(
              " "
            )}</p>
            <p style="margin: 10px">PROPOSITIONS USED BY: ${data.propsCitedBy.join(
              " "
            )}</p>
          </div>
        `;
      }

      //fetch data using book and prop to get the proper propositions from the euclid data on the server
      const getData = async (book, prop) => {
        try {
          const response = await fetch(
            `http://localhost:4000/book/${book}/prop/${prop}`
          );
          const data = await response.json();
          console.log(data)
          const div = document.querySelector("div");
          div.innerHTML = renderHTML(data);
          document.querySelectorAll(".input").forEach((node) => {
            node.value = "";
          });
        } catch (e) {
          console.log(e, "data could not be fetched");
        }
      };

      //event listener for submitting form
      btn.addEventListener("click", (e) => {
        e.preventDefault();

        const propObj = [];
        document.querySelectorAll(".input").forEach((node) => {
          propObj.push(node.value);
        });

        getData(...propObj);
      });
    </script>
  </body>
</html>
